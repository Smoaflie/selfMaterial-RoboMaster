# 项目介绍

调 麦轮底盘+云台 ，实现全向移动、底盘跟随、小陀螺等基础功能

使用了freeRTOS V2

# 相关设置

底盘轮组电机电调ID为1-4，云台6020电机(Yaw轴)的电调ID为1，云台6020电机(Pitch轴)的电调ID为5

# 项目内容

- **遥控器：**`左摇杆`-控制`云台`(Pitch Yaw)    `右摇杆`-控制`底盘`(全向移动)

- **底盘：**遥控器控制-速度正常，要启动快停得稳。

- **云台：**Pitch 和 Yaw 轴电机控制定角度，不超调，不抖动，反应快。

- **底盘跟随：**Yaw 轴旋转，控制底盘跟随旋转，旋转时底盘不超调、不抖动。

## 细则:

控制云台Yaw轴时：
- `跟随模式`下摇杆控制的是云台的位置  （即：用手扭转云台，松手后会快速转回原位置）

- ~~`云台自由移动`下摇杆控制的是云台转动的速度和方向  （即：用手扭转云台，松手后不回原位）~~

> 这是老5号全向轮的逻辑，暂不知道云台控制分为两种模式的原因，以后上车的时候需询问视觉喜欢哪种方案

对于底盘跟随模式：

- 底盘跟随设置1-2°（底盘的旋转）死区，防止持续旋转

模式控制：

> **拨杆双上时**，云台底盘能被正常控制，且底盘速度为正常模式。
>
> **左上右中时**，云台底盘能被正常控制，且底盘速度为高速模式。
>
> **左上右下时**，云台能被正常控制，底盘为小陀螺模式。 
>
> **左中右上时**，底盘停转，云台自由移动。
> 
> **拨杆双中时**，重新设置云台相对于底盘的方向（pitch轴会掉下来）。
>
> **拨杆双下时**，云台无力，底盘速度保持为 0。

# 食用推荐

所有代码文件都在`/User`文件夹下

参考以下目录结构，相关函数的功能请查看注释

```
📦User
 ┣ 📂Chassis			#底盘
 ┃ ┣ 📜chassis.c		#chassis_task
 ┃ ┗ 📜chassis.h
 ┣ 📂Controller			#控制器
 ┃ ┣ 📜controller.c		#controller_task
 ┃ ┗ 📜controller.h
 ┣ 📂Gimbal				#云台
 ┃ ┣ 📜gimbal.c			#gimbal_task
 ┃ ┗ 📜gimbal.h
 ┣ 📂Gyro				#陀螺仪
 ┃ ┣ 📜bmi088_driver.c
 ┃ ┣ 📜bmi088_driver.h
 ┃ ┣ 📜bmi088_reg.h
 ┃ ┣ 📜gyro.c			#gyro_task
 ┃ ┣ 📜gyro.h
 ┃ ┗ 📜type_define.h
 ┣ 📂motor				#电机
 ┃ ┣ 📜motor.c
 ┃ ┣ 📜motor.h
 ┃ ┣ 📜pid.c
 ┃ ┣ 📜pid.h
 ┃ ┣ 📜usr_CAN.c		#CAN配置
 ┃ ┗ 📜usr_CAN.h
 ┣ 📜usr_main.c			#代替 main.c - init_
 ┗ 📜usr_main.h
```

# CHANGELOG

12.5  -上手了下战队内的五号全向轮，重新制定操作逻辑，改用双环PID

12.5-12.14 ver1- 已完全实现预想功能(调了好久的Pitch轴，发现是CAN通信出了问题……)

> - 修改CAN发送函数，并在连续的CAN发送间增加间隔（即等待第一次CAN发送完成后再进行之后的两次连续发送）
>   - 经测试，CAN总线短时间内只能连续发两个包，原因不明
> - 取消定时器TIM3的使用
>   - 发现Pitch轴对时间有较高的要求，如使用（1000Hz）定时器定时发送数据会存在明显抖动
> - 云台电机的速度环参数由原`转子速度`全更改为`陀螺仪角速度`
>   - 陀螺仪角速度精度比转子速度更高
> - 删除云台电机死区设置
> - 降低小陀螺状态的移动速度
> - 删除急停代码
>   - ~~写了等于没写，用不了一点~~
> - 无法实现在`云台自由模式`时`用手扭转云台，松手后不回原位`
> - 仍保留部分测试用的代码（例如调PID的正弦曲线、急停等）
>   - ~~懒得删了~~
> - 加了个全向轮的移动函数
>   - ~~和原麦克纳姆轮的移动函数没区别~~
> - 优化目录结构
> - 优化文档内容，加入路径树方便查阅
> - 优化整体代码的可读性和逻辑性

12.14-12.15 ver2 - 将代码放到FreeRTOS中

> - 增加云台Pitch轴限位（通过机械角度）
> - 修改控制器逻辑（左摇杆控制云台，右摇杆控制底盘）'
> - ~~没有整理代码~~
> - （完）
